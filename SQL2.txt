CREATE DATABASE MUSTERİ_DB; --MUSTERİ_DB ADINDA BİR DB OLUŞTURDUK--

USE MUSTERİ_DB;--MUSTERİ_DB TAPLOSUNA GEÇİLDİ YAPILAN İŞLEMLER MUSTERİ_DB ÜZERİNDEN GERÇEKLEŞTİRİLİCEK--

CREATE TABLE MUSTERI(                  --MUSTERI ADINDA BİR TABLO OLUŞTURUYORUZ--
ID INT IDENTITY(1,1) PRIMARY KEY,      --ID ADINDA İNT DEĞER ALAN 1DEN BAŞLAYIP BİR BİR ARTAN BİR BİRİNCİL ANAHTAR OLAN BİR STUUN OLUŞTURDUK--
AD VARCHAR(20),                        --AD ADINDA MAX 20 KARAKTER UZUNLUĞUNDA KARAKTER ALABİLEN BİR SÜTUN OLUŞTURULDU--
SOYAD VARCHAR(20),                     --SOYAD ADINDA YİNE 20 KARAKTER ALABİLEN BİR SÜTUN OLUŞTURULDU--
EMAIL VARCHAR(20)                      --EMAIL ADINDA YİNE 20 KARAKTER ALABİLEN BİR SÜTUN OLUŞTURULDU--
);

CREATE TABLE SIPARIS(                             --MUSTERI ADINDA BİR TABLO OLUŞTURUYORUZ--
ID INT IDENTITY(1,1) PRIMARY KEY,                 --ID ADINDA İNT DEĞER ALAN 1DEN BAŞLAYIP BİR BİR ARTAN BİR BİRİNCİL ANAHTAR OLAN BİR STUUN OLUŞTURDUK--
SIPARIS_TARIHI DATE,                              --SİPARİS TARİHİ İÇİN TARİH DEĞERİ ALAN BİR SÜTUN OLUŞTURULDU--
TUTAR DECIMAL(5,2),                               --TUTAR İÇİN VİRGÜLDEN ÖNCE 5 BASAMAK VİRGÜLDEN SONRA 2 BASAMAK DEĞER ALAN DECİMAL DEĞER ALAN BİR SÜTUN OLUŞTURDUK
MUSTERI_ID INT                                    --MUSTERİ İD SİNİ TUTAN İNT DEĞERLİ BİR SÜTUN-- 
FOREIGN KEY(MUSTERI_ID) REFERENCES MUSTERI(ID)    --MUSTERI_ID İLE MÜSTERİ TABLOSUNDAKİ İD DEĞERİNİ BAĞLADIK MÜSTERİ TABLOSUNDA OLMAYAN BİR İD DEĞERİ GİRİLEMEZ--
);

INSERT INTO MUSTERI(AD,SOYAD,EMAIL)                --MÜSTERİ TABLOSUNA ELEMANLAR EKLENDİ--
VALUES ('UFUK','KUBILAY','UFUK@KUBILAY.COM'),
       ('ALPER','DILEKTASLI','ALPER@DILEKTASLI'),
	   ('ONUR','KARDES','ONUR@KARDES.COM'),
	   ('DENIZ','KAYNAK','DENIZ@KAYNAK.COM'),
	   ('ELIF','INCE','ELIF@INCE.COM');

SELECT * FROM MUSTERI;    --TABLOYU KONTROL ETMEK İÇİN TABLOYU LİSTELEDİK--

INSERT INTO SIPARIS(SIPARIS_TARIHI,TUTAR,MUSTERI_ID)   --SİPARİS TABLOSUNA ELEMANLAR EKLENDİ--
VALUES('2021/07/08','99.99',1),
      ('2021/07/09','120.01',1),
	  ('2021/03/04','24.87',2),
	  ('2021/06/01','700',2),
	  ('2021/05/26','65.90',5);

SELECT * FROM SIPARIS;    --TABLOYU KONTROL ETMEK İÇİN TABLOYU LİSTELEDİK--

SELECT AD,SOYAD,SIPARIS_TARIHI,TUTAR FROM MUSTERI JOIN SIPARIS ON MUSTERI.ID=SIPARIS.MUSTERI_ID;

SELECT AD, SOYAD,SUM(TUTAR) AS TOPLAM_HARCAMA FROM MUSTERI JOIN SIPARIS ON MUSTERI.ID=SIPARIS.MUSTERI_ID GROUP BY MUSTERI.AD,MUSTERI.SOYAD ORDER BY TOPLAM_HARCAMA DESC;

SELECT * FROM MUSTERI LEFT JOIN SIPARIS ON MUSTERI.ID=SIPARIS.MUSTERI_ID;

SELECT AD,SOYAD,ISNULL(SUM(TUTAR),0) AS TOPLAM_HARCAMA FROM MUSTERI LEFT JOIN SIPARIS ON MUSTERI.ID=SIPARIS.MUSTERI_ID GROUP BY MUSTERI.AD,MUSTERI.SOYAD ORDER BY TOPLAM_HARCAMA DESC; 